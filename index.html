<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Apper by asyncanup</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Apper</h1>
        <p>Plug and play, restful, real-time application framework for single page apps</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/asyncanup/apper" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/asyncanup/apper/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/asyncanup/apper/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>
<a name="apper" class="anchor" href="#apper"><span class="octicon octicon-link"></span></a>Apper</h1>

<p>Plug and play, restful, real-time application framework for single page apps.</p>

<p><a href="https://travis-ci.org/asyncanup/apper" title="Build Status on Travis CI"><img src="https://api.travis-ci.org/asyncanup/apper.png" alt="Build Status on Travis CI"></a>
<a href="http://badge.fury.io/js/apper" title="NPM Latest Version"><img src="http://badge.fury.io/js/apper.png" alt="NPM Latest version"></a></p>

<h2>
<a name="app" class="anchor" href="#app"><span class="octicon octicon-link"></span></a>App</h2>

<p>A regular directory becomes a valid app if it has one or more of the following:</p>

<ul>
<li>An environment settings module with the name <code>environment.js</code>
</li>
<li>A middleware module with the name <code>middleware.js</code>
</li>
<li>A socket subscription module with the name <code>sockets.js</code>
</li>
<li>A static content directory with the name <code>public</code>
</li>
<li>A routes module with the name <code>routes.js</code>
</li>
</ul><p>All of the default file/directory names above can be changed by options in 
<code>apper.json</code> file in any directory.</p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<p>For usage as command-line tool:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>npm install -g apper
</pre></div>

<p>For usage in code:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>npm install apper
</pre></div>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="from-command-line" class="anchor" href="#from-command-line"><span class="octicon octicon-link"></span></a>From command-line</h3>

<p>Just open the shell (or command prompt) in the app directory
(with one or more of the above-mentioned files), and run:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>apper
</pre></div>

<p>And open <code>http://localhost:8000</code> in browser.</p>

<p>Run <code>apper -h</code> for all the command-line options.</p>

<p>A more specific deployment might look like:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>apper --port <span class="m">8080</span> --address 127.0.0.0 code/src
</pre></div>

<p>Here, <code>code/src</code> is the root path of the application code, relative to current
directory from which <code>apper</code> is run. It defaults to the current directory itself.</p>

<p>To display internal logs during development (helpful), just set <code>DEBUG</code> environment
variable to <code>apper:*</code></p>

<div class="highlight highlight-bash"><pre><span class="nv">$ DEBUG</span><span class="o">=</span>apper:* apper --port 8000
</pre></div>

<p>For a working example, check out <code>test/sample</code> which is used by the tests.
Just run <code>apper</code> in the shell there and read the tests to get a better understanding.</p>

<h2>
<a name="motivation" class="anchor" href="#motivation"><span class="octicon octicon-link"></span></a>Motivation</h2>

<p><a href="http://expressjs.com" title="Express.js">Express</a> isn't enough. It lacks structure and conventions.</p>

<p>Apper provides:</p>

<ul>
<li>Much needed <strong>structure</strong> to server-side code with strong conventions</li>
<li>Reliable <strong>directory hierarchy</strong> for code based on REST end-points</li>
<li>Design for <strong>real-time</strong> right off the bat</li>
<li>Transparent <strong>minification &amp; bundling</strong> for single page apps</li>
</ul><p>The core idea of <code>apper</code> is to enable easy REST api based node.js apps, especially 
useful for Single Page Applications.</p>

<p>Apper lets you create bigger apps by using smaller independent chunks as subapps.
Simply place individual subapps anywhere in the directory hierarchy, and they get
exposed under a relative base URL.</p>

<p>Nested subapps are totally cool and highly encouraged.
In fact, simply by moving a subapp directory to another directory updates the exposed 
relative URL of that subapp. No frills.</p>

<h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<h3>
<a name="example-directory-structure" class="anchor" href="#example-directory-structure"><span class="octicon octicon-link"></span></a>Example directory structure</h3>

<pre><code>+ root/
.... server.js (See Programmatic Usage section below)
.... routes.js (GET /login)
    + public/
    .... index.html
    .... main.js

    + api/
    .... routes.js (GET /, POST /)

        + items/
        .... middleware.js
        .... routes.js (GET /, GET /last)
</code></pre>

<p><em>routes.js</em> files above are supposed to specify route handlers for paths mentioned
against them.</p>

<p>Read below for code samples for all of them.</p>

<h3>
<a name="api-exposed-by-the-directory-structure-above" class="anchor" href="#api-exposed-by-the-directory-structure-above"><span class="octicon octicon-link"></span></a>API exposed by the directory structure above</h3>

<pre><code>GET  /
GET  /login

GET  /api
POST /api

GET  /api/items
GET  /api/items/last
</code></pre>

<p>The route <code>/</code> serves <code>index.html</code> in <code>public/</code> by default.
Can be overridden by including a route <code>GET /</code> in <code>routes.js</code>.</p>

<h2>
<a name="core-concepts" class="anchor" href="#core-concepts"><span class="octicon octicon-link"></span></a>Core Concepts</h2>

<h4>
<a name="order-of-initialization-of-modules" class="anchor" href="#order-of-initialization-of-modules"><span class="octicon octicon-link"></span></a>Order of initialization of modules</h4>

<p>The following modules get initialized on the subapp in order:</p>

<ul>
<li>
<code>environment.js</code> to set environment settings using <code>app.set</code> (like Express)</li>
<li>
<code>middleware.js</code> to setup middleware functions using <code>app.use</code> (like Express)</li>
<li>
<code>sockets.js</code> to setup WebSocket subscriptions between server and client</li>
<li>
<code>public</code> exposed as static content directory</li>
<li>
<code>routes.js</code> to respond to URL end-points (using <code>app.get</code>, <code>app.post</code>, etc.)</li>
</ul><h3>
<a name="bigger-apps-composed-of-small-apps" class="anchor" href="#bigger-apps-composed-of-small-apps"><span class="octicon octicon-link"></span></a>Bigger apps composed of small apps</h3>

<p>The root app can contain sub-directories which are complete apps unto themselves. 
These directories become subapps of the root app (or sub APIs, if you may).</p>

<p>Subapps can be pulled out and placed anywhere in the overall directory structure.
This would make them available on the new relative url with respect to the root.</p>

<p>Every subapp directory can be started as a separated app just by running <code>apper</code> in there.</p>

<p>Due to the directory hierarchy based mounting of subapps, the base URL paths of
all subapps are decided by their position in the directory hierarchy.</p>

<p>The subapps can then register for any relative URL route after their base URL and
handle requests accordingly.</p>

<h2>
<a name="programmatic-usage" class="anchor" href="#programmatic-usage"><span class="octicon octicon-link"></span></a>Programmatic Usage</h2>

<h3>
<a name="as-a-module" class="anchor" href="#as-a-module"><span class="octicon octicon-link"></span></a>As a module</h3>

<p>Create a file (say, <code>server.js</code>) in your application directory</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'apper'</span><span class="p">)({</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">8000</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</pre></div>

<p>Then, running <code>server.js</code> will start the application on port 8000. For example:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>node server.js
</pre></div>

<p>To see internal logs (helpful during development), just set the environment variable <code>DEBUG</code> as follows:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ DEBUG</span><span class="o">=</span>apper:* node server.js
</pre></div>

<h3>
<a name="as-express-application" class="anchor" href="#as-express-application"><span class="octicon octicon-link"></span></a>As Express application</h3>

<p>Create an application object as usual, and use <code>app.expressApp</code> as a regular express application</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'apper'</span><span class="p">)();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">expressApp</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</pre></div>

<h3>
<a name="as-express-middleware" class="anchor" href="#as-express-middleware"><span class="octicon octicon-link"></span></a>As Express middleware</h3>

<p>You can use this application as middleware in your regular express app as follows:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'apper'</span><span class="p">)();</span>
<span class="nx">myExpressApp</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">expressApp</span><span class="p">);</span>
</pre></div>

<p>Mounting your <strong>apper</strong> app as an Express subapp is as easy:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'apper'</span><span class="p">)();</span>
<span class="nx">myExpressApp</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/blog'</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">expressApp</span><span class="p">);</span>
</pre></div>

<p>Now the <strong>apper</strong> application gets confined to <code>/blog</code> base URL.</p>

<h2>
<a name="more-code" class="anchor" href="#more-code"><span class="octicon octicon-link"></span></a>More Code</h2>

<h3>
<a name="startup" class="anchor" href="#startup"><span class="octicon octicon-link"></span></a>Startup</h3>

<p>Apper synchronously loads its modules when you initialize it. You can start the
server by calling <code>app.start()</code>.</p>

<p>Constructor options look like this:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'apper'</span><span class="p">)({</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">'.'</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">8000</span><span class="p">,</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>

    <span class="c1">// Not commonly used. Just use `apper.json` for the configuration</span>
    <span class="nx">toOpenBrowser</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">staticDir</span><span class="o">:</span> <span class="s1">'public'</span><span class="p">,</span>
    <span class="nx">moduleNames</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">environment</span><span class="o">:</span> <span class="s1">'environment'</span>
        <span class="nx">middleware</span><span class="o">:</span> <span class="s1">'middleware'</span><span class="p">,</span>
        <span class="nx">routes</span><span class="o">:</span> <span class="s1">'routes'</span><span class="p">,</span>
        <span class="nx">sockets</span><span class="o">:</span> <span class="s1">'sockets'</span>
    <span class="p">},</span>
    <span class="nx">mountPath</span><span class="o">:</span> <span class="s1">''</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</pre></div>

<p>The default values for the options (path/port/etc) are as shown above.
The options mean the following:</p>

<ul>
<li>
<code>path</code>: Path for the directory to be taken as the root application.</li>
<li>
<code>port</code>: Port number on which to expose the application.</li>
<li>
<code>host</code>: Host name to be used for the application (<code>127.0.0.1</code>, <code>localhost</code>, <code>0.0.0.0</code>, etc).</li>
<li>
<code>toOpenBrowser</code>: Whether to open the system default browser with the created application.</li>
<li>
<code>staticDir</code>: Name of the static content directory.</li>
<li>
<code>moduleNames.*</code>: As discussed below in Structure of Modules.</li>
<li>
<code>mountPath</code>: Base URL to mount this application on. Used internally for mounting subapps.</li>
</ul><p>Server automatically starts a single socket.io WebSocket server that works across all subapps
but maintains separate namespaces for all communication with different subapps.</p>

<h3>
<a name="structure-of-modules" class="anchor" href="#structure-of-modules"><span class="octicon octicon-link"></span></a>Structure of modules</h3>

<p>Get an Express-based app object and run express methods like 
<code>app.set</code>, <code>app.use</code>, <code>app.get</code>, <code>app.post</code>, etc. on it.</p>

<p>For WebSocket requests, <code>app.sockets</code> provides the same functionality as
<code>io.sockets</code> using <a href="http://socket.io/" title="Socket.io">socket.io</a></p>

<h4>
<a name="environmentjs" class="anchor" href="#environmentjs"><span class="octicon octicon-link"></span></a>environment.js</h4>

<div class="highlight highlight-js"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'property'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">);</span>
    <span class="c1">// Environment configuration</span>
<span class="p">};</span>
</pre></div>

<h4>
<a name="middlewarejs" class="anchor" href="#middlewarejs"><span class="octicon octicon-link"></span></a>middleware.js</h4>

<div class="highlight highlight-js"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// middleware code</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<h4>
<a name="routesjs" class="anchor" href="#routesjs"><span class="octicon octicon-link"></span></a>routes.js</h4>

<div class="highlight highlight-js"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'hey'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<h4>
<a name="socketsjs" class="anchor" href="#socketsjs"><span class="octicon octicon-link"></span></a>sockets.js</h4>

<div class="highlight highlight-js"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'hey'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'Hey '</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">'!'</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<h4>
<a name="client-side-socket-code" class="anchor" href="#client-side-socket-code"><span class="octicon octicon-link"></span></a>Client-side socket code</h4>

<p>Client-side code corresponding to <code>sockets.js</code> looks as simple.</p>

<p>Just include <code>&lt;script src='/socket.io/socket.io.js'&gt;&lt;/script&gt;</code> in <code>public/index.html</code>,
and connect to the socket server like this:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">();</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connect'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'woohoo!'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>A subapp client connects by default to its own namespace, as per its directory hierarchy.
So you won't have 2 different subapps catching each others socket events.</p>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p><code>apper.json</code> placed in root or any subapp directory controls the following
configuration for the respective app:</p>

<ul>
<li>
<p><code>moduleNames.environment</code> (Example: <em>'env'</em>)</p>

<p>Environment module file name for the current app</p>
</li>
<li>
<p><code>moduleNames.middleware</code> (Example: <em>'mid'</em>)</p>

<p>Middleware module file name for the current app</p>
</li>
<li>
<p><code>moduleNames.sockets</code> (Example: <em>'sock'</em>)</p>

<p>Socket subscriptions module for the current app</p>
</li>
<li>
<p><code>moduleNames.routes</code> (Example: <em>'route-definitions'</em>)</p>

<p>Routes module file name for the current app</p>
</li>
<li>
<p><code>staticDir</code> (Example: <em>'www'</em>)</p>

<p>Static content directory name for the current app.</p>
</li>
<li>
<p><code>dirToIgnore</code> (Example: <em>['subapp', 'another']</em>)</p>

<p>List of directories to not consider as subapps in the current app's directory.</p>
</li>
<li>
<p><code>bundle</code> (Example: <em>true</em>/<em>false</em>)</p>

<p>Whether to transparently minify and inline all JavaScript and CSS resources, 
including RequireJS modules. Cached on first use, and served as is thereon.</p>

<p>You can include <code>require-config.js</code> in RequireJS <code>baseUrl</code> directory to specify
custom RequireJS options for bundling. Usually not required.</p>
</li>
</ul><h3>
<a name="sample-apperjson-configuration-file" class="anchor" href="#sample-apperjson-configuration-file"><span class="octicon octicon-link"></span></a>Sample <code>apper.json</code> configuration file</h3>

<pre><code>{
    "moduleNames: {
        "environment": "env",
        "middleware": "mid",
        "sockets": "sock",
        "routes": "route-definitions"
    },
    "staticDir": "www",
    "dirToIgnore": ["subapp", "another"],
    "bundle": true
}
</code></pre>

<h2>
<a name="tests" class="anchor" href="#tests"><span class="octicon octicon-link"></span></a>Tests</h2>

<p>To run tests yourself, install <code>mocha</code></p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>npm install
<span class="nv">$ </span>npm install -g mocha
</pre></div>

<p>In the project directory, run</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>npm <span class="nb">test</span>
</pre></div>

<p>Check out the <code>test</code> directory for usage examples.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/asyncanup">asyncanup</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-4830349-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>